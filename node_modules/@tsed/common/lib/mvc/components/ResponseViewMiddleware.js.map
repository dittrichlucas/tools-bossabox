{"version":3,"sources":["mvc/components/ResponseViewMiddleware.ts"],"names":[],"mappings":";;;;AAAA,mCAAmC;AACnC,gEAA2D;AAC3D,+DAA0D;AAC1D,wEAAmE;AACnE,gEAA2D;AAC3D,wEAAmE;AACnE,6EAAwE;AAGxE;;;GAGG;AAEH,IAAa,sBAAsB,8BAAnC,MAAa,sBAAsB;IAC1B,GAAG,CAAiB,IAAS,EAAkB,QAA0B,EAAc,QAA0B;QACtH,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;YACrC,MAAM,EAAC,QAAQ,EAAE,WAAW,EAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,wBAAsB,CAAC,CAAC;YAE3E,IAAI,QAAQ,KAAK,SAAS,EAAE;gBAC1B,IAAI,WAAW,KAAK,SAAS,EAAE;oBAC7B,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,EAAE,WAAW,CAAC,CAAC;iBAC7C;gBAED,QAAQ,CAAC,MAAM,CAAC,QAAQ,EAAE,IAAI,EAAE,CAAC,GAAQ,EAAE,IAAI,EAAE,EAAE;oBACjD,0BAA0B;oBAC1B,IAAI,GAAG,EAAE;wBACP,MAAM,CAAC,IAAI,+CAAsB,CAAC,QAAQ,CAAC,MAAM,EAAE,QAAQ,CAAC,eAAe,EAAE,GAAG,CAAC,CAAC,CAAC;qBACpF;yBAAM;wBACL,2BAA2B;wBAC3B,OAAO,CAAC,IAAI,CAAC,CAAC;qBACf;gBACH,CAAC,CAAC,CAAC;aACJ;iBAAM;gBACL,OAAO,EAAE,CAAC;aACX;QACH,CAAC,CAAC,CAAC;IACL,CAAC;CACF,CAAA;AAvBC;IAAY,mBAAA,2BAAY,EAAE,CAAA,EAAa,mBAAA,2BAAY,EAAE,CAAA,EAA8B,mBAAA,mBAAQ,EAAE,CAAA;;qDAA7B,mCAAgB;;iDAsB/E;AAvBU,sBAAsB;IADlC,uBAAU,EAAE;GACA,sBAAsB,CAwBlC;AAxBY,wDAAsB","file":"ResponseViewMiddleware.js","sourcesContent":["import * as Express from \"express\";\nimport {EndpointMetadata} from \"../class/EndpointMetadata\";\nimport {Middleware} from \"../decorators/class/middleware\";\nimport {EndpointInfo} from \"../../filters/decorators/endpointInfo\";\nimport {Response} from \"../../filters/decorators/response\";\nimport {ResponseData} from \"../../filters/decorators/responseData\";\nimport {TemplateRenderingError} from \"../errors/TemplateRenderingError\";\nimport {IMiddleware} from \"../interfaces\";\n\n/**\n * @private\n * @middleware\n */\n@Middleware()\nexport class ResponseViewMiddleware implements IMiddleware {\n  public use(@ResponseData() data: any, @EndpointInfo() endpoint: EndpointMetadata, @Response() response: Express.Response) {\n    return new Promise((resolve, reject) => {\n      const {viewPath, viewOptions} = endpoint.store.get(ResponseViewMiddleware);\n\n      if (viewPath !== undefined) {\n        if (viewOptions !== undefined) {\n          data = Object.assign({}, data, viewOptions);\n        }\n\n        response.render(viewPath, data, (err: any, html) => {\n          /* istanbul ignore next */\n          if (err) {\n            reject(new TemplateRenderingError(endpoint.target, endpoint.methodClassName, err));\n          } else {\n            // request.storeData(html);\n            resolve(html);\n          }\n        });\n      } else {\n        resolve();\n      }\n    });\n  }\n}\n"],"sourceRoot":"../../../src"}