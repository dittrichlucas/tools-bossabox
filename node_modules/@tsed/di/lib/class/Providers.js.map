{"version":3,"sources":["class/Providers.ts"],"names":[],"mappings":";;AAAA,qCAAuD;AAGvD,yCAAoC;AAEpC,MAAa,SAAU,SAAQ,eAAuC;IAOpE;QACE,KAAK,CAAC,mBAAQ,CAAC,CAAC;QAPlB;;;WAGG;QACK,gBAAW,GAAkC,IAAI,GAAG,EAAE,CAAC;IAI/D,CAAC;IAED;;;;;;OAMG;IACH,cAAc,CAAC,IAAY,EAAE,KAA0B,EAAE,OAAkC;QACzF,MAAM,QAAQ,GAAG,IAAI,eAAQ,CAAgC,KAAK,EAAE;YAClE,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC;SAC9B,CAAC,CAAC;QAEH,IAAI,CAAC,WAAW,CAAC,GAAG,CAClB,IAAI,EACJ,MAAM,CAAC,MAAM,CACX;YACE,QAAQ;YACR,UAAU,EAAE,IAAI;YAChB,SAAS,EAAE,IAAI;SAChB,EACD,OAAO,CACR,CACF,CAAC;QAEF,OAAO,QAAQ,CAAC;IAClB,CAAC;IAED;;;;OAIG;IACH,mBAAmB,CAAC,MAA4B;QAC9C,IAAI,IAAI,GAAW,UAAU,CAAC;QAE9B,IAAI,OAAO,MAAM,KAAK,QAAQ,EAAE;YAC9B,IAAI,GAAG,MAAM,CAAC;SACf;aAAM;YACL,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YAClC,IAAI,QAAQ,EAAE;gBACZ,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;aACtB;SACF;QAED,IAAI,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;YAC9B,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAE,CAAC;SACpC;QAED,OAAO;YACL,QAAQ,EAAE,IAAI;YACd,UAAU,EAAE,IAAI;YAChB,SAAS,EAAE,IAAI;SAChB,CAAC;IACJ,CAAC;IAED;;;OAGG;IACH,gBAAgB,CAAC,IAAY;QAC3B,OAAO,CAAC,QAA8B,EAAE,QAAc,EAAQ,EAAE;YAC9D,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE;gBACrB,QAAQ,GAAG;oBACT,OAAO,EAAE,QAAQ;iBAClB,CAAC;aACH;YAED,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC,EAAC,QAAQ,EAAC,EAAE,QAAQ,EAAE,EAAC,IAAI,EAAC,CAAC,CAAC;YACvD,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;QAC3D,CAAC,CAAC;IACJ,CAAC;IAED;;;;OAIG;IACH,WAAW,CAAC,MAA4B;QACtC,OAAO,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC;IACnD,CAAC;CACF;AA3FD,8BA2FC","file":"Providers.js","sourcesContent":["import {Registry, RegistryKey, Type} from \"@tsed/core\";\nimport {IProvider, TypedProvidersRegistry} from \"../interfaces\";\nimport {RegistrySettings} from \"../interfaces/RegistrySettings\";\nimport {Provider} from \"./Provider\";\n\nexport class Providers extends Registry<Provider<any>, IProvider<any>> {\n  /**\n   * Internal Map\n   * @type {Array}\n   */\n  private _registries: Map<string, RegistrySettings> = new Map();\n\n  constructor() {\n    super(Provider);\n  }\n\n  /**\n   *\n   * @param {string} type\n   * @param {Type<Provider<any>>} model\n   * @param options\n   * @returns {Registry<Provider<any>, IProvider<any>>}\n   */\n  createRegistry(type: string, model: Type<Provider<any>>, options: Partial<RegistrySettings>): TypedProvidersRegistry {\n    const registry = new Registry<Provider<any>, IProvider<any>>(model, {\n      onCreate: this.set.bind(this)\n    });\n\n    this._registries.set(\n      type,\n      Object.assign(\n        {\n          registry,\n          injectable: true,\n          buildable: true\n        },\n        options\n      )\n    );\n\n    return registry;\n  }\n\n  /**\n   *\n   * @param {string | RegistryKey} target\n   * @returns {RegistrySettings | undefined}\n   */\n  getRegistrySettings(target: string | RegistryKey): RegistrySettings {\n    let type: string = \"provider\";\n\n    if (typeof target === \"string\") {\n      type = target;\n    } else {\n      const provider = this.get(target);\n      if (provider) {\n        type = provider.type;\n      }\n    }\n\n    if (this._registries.has(type)) {\n      return this._registries.get(type)!;\n    }\n\n    return {\n      registry: this,\n      injectable: true,\n      buildable: true\n    };\n  }\n\n  /**\n   *\n   * @returns {(provider: (any | IProvider<any>), instance?: any) => void}\n   */\n  createRegisterFn(type: string) {\n    return (provider: any | IProvider<any>, instance?: any): void => {\n      if (!provider.provide) {\n        provider = {\n          provide: provider\n        };\n      }\n\n      provider = Object.assign({instance}, provider, {type});\n      this.getRegistry(type).merge(provider.provide, provider);\n    };\n  }\n\n  /**\n   *\n   * @param {string | RegistryKey} target\n   * @returns {Registry<Provider<any>, IProvider<any>>}\n   */\n  getRegistry(target: string | RegistryKey): TypedProvidersRegistry {\n    return this.getRegistrySettings(target).registry;\n  }\n}\n"],"sourceRoot":"../../src"}